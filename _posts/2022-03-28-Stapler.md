---
layout: post
current: post
cover:  assets/images/design.jpg
navigation: True
title: Stapler - VulnHub
date: 2022-03-28 04:00:00
tags: [Getting started]
class: post-template
subclass: 'post'
author: farhaan
---
## Appendix A

```
Table 1 - Summary of Security Vulnerabilities Assessment by Muhammad Farhaan
No. Hostname OS No. of Exploits Item
No.
```
```
Exploit Name
```
```
2 Red.initech Ubuntu
16.04 LTS
(Kernel:
Linux
4.4.0-21-ge
neric)
```
```
2 1/5.1 SMB service
```
```
2/5.2 httpd service
```
### Table 2 - Vulnerabilities Assessment Details by Muhammad Farhaan

```
Item No: x.x Finding Name
Risk Rating Critical/High/Medium/Low/Info
CVSSv3 Score Base: 5.5 Temporal: 5.
CVSSv3 Vectors CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L/E:P/RL:W/RC:C
Description The background information of this finding
Impact What can you do with this finding?
Affected Assets 192.168.56.103:
192.168.56.101:
Technical Details
```
- This section should document your actual pen-test steps and results
- There should be evidence that substantiate every claim made in the Impact section:
    -

### o Scan result such as OS version, Service open, App version, IP address, MAC address

### o User list, passwords, obtain shell, escalated privilege etc.

- Other valuable information: -oScreen captures andcommands should be included with the
    description and explanation for them
**The reader must be able to replicate and demo the result by following your steps in this section.**


# Stage 1: Active Reconnaissance

## Let us first identify the IP address of the target machine.

## Steps:

## Nmap Scan the IP Range of 192.168.56.0/24 (Found in General

## Requirements)

## Nmap -n option :

```
Nmap Scan the IP Range of 192.168.56.0/24. To identify which IP address is your target VM, you
can see that 192.168.56.108 and 192.168.56.109 is running through Oracle VirtualBox virtual NIC
and since 192.168.56.109 is my Kali VM’s IP Address, 192.168.56.108 is our target VM’s IP address.
```

Let us aggressive scan all of the ports of our target VM.


As you can see several ports is open. Ports 22, 53, 80, 139,66,3306,12380 are open


Let as






Recommendation _e.g. Patch to version x_


```
References State the hyperlinks of the followings (if applicable): -•
Tools used
```
- Your references/research of this vulnerability, exploit and
    resolution here.
- CWE/CAPEC/CVE/OWASP references.

### Table 2 - Vulnerabilities Assessment Details by Muhammad Farhaan

```
Item No: x.x Finding Name
Risk Rating Critical/High/Medium/Low/Info
CVSSv3 Score Base: 5.5 Temporal: 5.
CVSSv3 Vectors CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L/E:P/RL:W/RC:C
Description The background information of this finding
Impact What can you do with this finding?
Affected Assets 192.168.56.103:
192.168.56.101:
```
```
Technical Details
```
- This section should document your actual pen-test steps and results
- There should be evidence that substantiate every claim made in the Impact section:
    -

### o Scan result such as OS version, Service open, App version, IP address, MAC address

### o User list, passwords, obtain shell, escalated privilege etc.

- Other valuable information: -oScreen captures andcommands should be included with the
    description and explanation for them
**The reader must be able to replicate and demo the result by following your steps in this section.**


Nmap scan is used to determine the ports that are open.
The option -Pn is to run port scan only and disable host discovery.
The option -T5 is for insane speed scan. This allows the nmap scan to run much faster since we are
scanning all ports.
The option -p- is to scan all ports from port 1 to port 65,535. Using this option, will make nmap scan all
ports allowing any hidden open ports to show as well.
As you can see port 12380 is open but the service is unknown

This command is to Aggressive scan port 12380. The reason for this is because we found that port
12380 is open but the service is unknown hence aggressive scanning the port might give us the service
that is running on the port.
As we can see, port 12380 is running a http service and it’s version is Apache httpd 2.4.18 ((Ubuntu)
On a non-standard port, an Apache server is operating. So let us take a look at it as it might give some
useful information or even allow us to exploit into the target machine.


```
Searchhttp://192.168.56.108:12380. This will bringus to this page. Nothing important or useful can be
found here. Inspecting the webpage also doesn’t give us anything useful. So let us use a Web
Application Analysis tool to get more information from this website.
```
Nikto is a web server scanner so let us use that to scan the web server.
Run the command and wait for the output. As you can see Nikto has revealed a number of useful
information that can be used.


Firstly, we can see that the website has the SSL certificate and uses SSL. SSL is Secure Sockets Layer. It is
a security protocol.
When a website has the SSL certificate, https is in the URL instead of http.

```
Nikto has also found 3 directories which are /admin112233/, /blogblog/ and /phpmyadmin/. Lastly,
Nikto has found a robots.txt file.
```
```
Openinghttps://192.168.56.108:12380/robots.txtallowedus to find the directories that were found in
the nikto scan.
```
```
Openinghttps://192.168.56.108:12380/admin112233didnot help us find anything at all.
```

Openinghttps://192.168.56.108:12380/phpmyadmin/broughtus to a database login page. This is not
useful information
(DON’T KNOW IF I SHOULD KEEP THIS)

Fortunately, openinghttps://192.168.56.108:12380/blogblog/has brought us to a website run by
WordPress. So now we can use wpscan(WordPress scan) to scan and enumerate users and plugins.


The command is wpscan --urlhttps://192.168.56.12380/blogblog-e u --disable-tls-checks
-e u is enumerating users
--disable-tls-checks disables the transport layer security so that wpscan can work.


These are the users that were found when enumerating users through wpscan
Users
john
elly
peter
barry
garry
harry
scott
kathy
tim
heather

John smith is the display name. This means that it is not the credentials that is used to log in. As you can
see John Smith owns this place. So we can assume he is the owner/admin of this website. So if we hack
into John smith’s account, we should be able to get full access to the website.

```
So, now let us use brute force attack to break into john’s account.
So let’s use the rockyou.txt dictionary to break into john’s account. The reason I am using rockyou.txt is
because it has approximately 14 million passwords. Hence it is very effective.
```
```
Let us run the command.
We got the password of john in our 1strequest.
```

```
Username: john
Password: incorrect
```
Now let us login into john using the password incorrect.

```
Now, let us upload a plugin
```

Now we will upload the php-reverse shell by pentest monkey as a plugin. Copy the link.

Lets a directory for the php-reverse shell. Then let us download the php-reverse shell in the directory.
Let us make some changes before uploading.


Change the Ip to our own Ip address
Change the port number to an unused port

Lets set up a listener first in port 443

Let’s upload the shell


```
Lets upload the shell
```
```
Click on install now
```
### We can access the shell by going to

### https://192.168.56.108:12380/blogblog/wp-content/uploads/.Now click on the shell that we just

### upload.


As you can see our kali VM’s port 443 that was listening received the signal

Now we have access to our target VM. We can prove this by looking at the ip address. Type the
command ifconfig and as you can see the ip address is 192.168.56.108 which is our target vm’s ip
address.

Use the python code to access the shell.


Anyone has the permission to read all files in the machine so let us take a look at the bash_history to
find useful information.

```
When we look through the bash_history , we have found two user credentials.
JKanode : thisismypassword
Peter: JZQuyIN5
```
Let us ssh into peter.


Type the password of peter : JZQuyIN5

```
Select 2
```
```
Check the ifconfig to double confirm that we are in our target machine.
```

Then run the command sudo -l. This lets us be the super user which gives us elevated priveleges. Then
Type the password for peter. Now let us sudo su root which allows us to switch the user to root. After
that let us check by running the command whoami. As you can see the output shows root. So we have
successfully completed privilege escalation. We can check the machine’s Operating System by running
the command hostnamectl, lsb_release -a and cat /etc/os-release.

**Privilege Escalation Method 3:**
This privilege escalation method can be used for exploit 1 after getting into the shell.
This method is abusing the cron job.


Upload the php-reverse shell plugin and in your kali command terminal open a listening netcat port.
After that click on the php-reverse-shell.php upload.

Once connected, import/use the python script to get a command shell/tty.


Change directory to /var/www/https/blogblog/wp-content/uploads
Then read the /etc/cron* file


Change directory to /etc. Let us now check for cron job files. As you can see there is a cron job called
logrotate. So we will change the command that will run in the cron job.

Let us take look at the content of the cron-logrotate.sh rile
There is no command in this cron job file so let us add one.




Recommendation _e.g. Patch to version x_


References State the hyperlinks of the followings (if applicable): -•Tools
used

- Your references/research of this vulnerability, exploit and resolution
    here.
- CWE/CAPEC/CVE/OWASP references.



